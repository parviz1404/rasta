Parviz Abdi, [15/06/1404 06:42 ب.ظ]
<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ماشین‌حساب ژئوتکنیک (گمانه/چاهک/برجا) — V7</title>

  <!-- PWA -->
  <meta name="theme-color" content="#111111" />
  <link rel="manifest" href="./manifest.webmanifest">
  <link rel="icon" href="./icon-192.png" sizes="192x192">
  <link rel="icon" href="./icon-512.png" sizes="512x512">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="GeoCalc V7">
  <link rel="apple-touch-icon" href="./icon-192.png">

  <style>
    :root{--bg:#fafafa;--fg:#111;--muted:#666;--card:#fff;--border:#e6e6e6}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--fg);font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Arial}
    .wrap{max-width:880px;margin:32px auto;padding:0 16px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:20px;box-shadow:0 6px 16px rgba(0,0,0,.04)}
    h1{font-size:20px;margin:0 0 12px}
    h2{font-size:16px;margin:24px 0 8px}
    label{display:block;font-weight:600;margin:12px 0 6px}
    input{width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:8px;background:#fff}
    .grid{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(180px,1fr))}
    button{padding:12px 16px;border:0;border-radius:10px;background:#111;color:#fff;font-weight:700;cursor:pointer}
    button:disabled{opacity:.5;cursor:not-allowed}
    .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin-top:12px}
    .muted{color:var(--muted);font-size:13px}
    table{width:100%;border-collapse:collapse;margin-top:8px}
    th,td{padding:10px;border-bottom:1px solid var(--border);text-align:center}
    kbd{background:#f2f2f2;border:1px solid #e0e0e0;border-bottom-width:2px;padding:2px 6px;border-radius:6px;font-family:ui-monospace,monospace}
    .pill{display:inline-block;background:#f2f2f2;border:1px solid #e6e6e6;border-radius:999px;padding:2px 8px;font-size:12px}
    footer{margin:24px 0 12px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>ماشین‌حساب گمانه، چاهک گود، آزمایشات برجا (نسخه V7)</h1>
      <p class="muted">ورودی‌ها را بر حسب متر و مترمربع وارد کنید. خروجی‌ها فقط عدد هستند.</p>

      <div class="grid">
        <div>
          <label for="S">S — سطح اشغال (m²)</label>
          <input id="S" type="number" inputmode="decimal" placeholder="مثلاً 2500" />
        </div>
        <div>
          <label for="D">D — عمق گود، Dmax (m)</label>
          <input id="D" type="number" inputmode="decimal" placeholder="مثلاً 27" />
        </div>
        <div>
          <label for="B">B — عرض مؤثر سطح اشغال (m)</label>
          <input id="B" type="number" inputmode="decimal" placeholder="مثلاً 22" />
        </div>
        <div>
          <label for="F">F — تعداد طبقات/سقف‌های سازه‌ای</label>
          <input id="F" type="number" inputmode="numeric" placeholder="مثلاً 12" />
        </div>
      </div>

      <div class="row">
        <button id="calc">محاسبه</button>
        <span class="muted">k<sub>B</sub> بر اساس S: <span class="pill"><kbd>≤300→2</kbd> ، <kbd>≤1000→1.5</kbd> ، <kbd>&gt;1000→1</kbd></span></span>
      </div>

      <h2>نتایج</h2>
      <table id="out">
        <thead>
          <tr>
            <th>عنوان</th>
            <th>مقدار</th>
            <th>واحد/توضیح</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <footer class="muted">
        قواعد: N فقط برای S&gt;1000 (هر پله ۱۰۰۰ متر ⇒ ۲ گمانه اضافه). M فقط برای D&gt;20 (هر ۱۰ متر ⇒ ۱ چاهک اضافه).<br/>
        آزمایشات برجا: D&lt;7 ⇒ 0 ، 7–10 ⇒ 1 ، &gt;10 ⇒ 2. دان‌هول: اگر F≥11 ⇒ ceil(گمانه/3)؛ وگرنه 0.
      </footer>
    </div>
  </div>

  <script>
    // ------- Logic (V7) -------
    function kB(S){ return (S<=300)?2 : (S<=1000?1.5:1); }

    // N: only if S>1000 → steps of 1000 above 1000; each step adds 2 boreholes
    function N_from_S(S){
      if(S<=1000) return 0;

Parviz Abdi, [15/06/1404 06:42 ب.ظ]
const steps = Math.ceil((S-1000)/1000);  // 1001..2000 => 1, 2001..3000 => 2, ...
      return 2*steps;
    }

    // M: only if D>20 → each 10 m above 20 adds 1 hand shaft (21..30 ->1, 31..40 ->2, ...)
    function M_from_D(D){
      if(D<=20) return 0;
      return Math.ceil((D-20)/10);
    }

    function min_boreholes(S){
      const base = (S<=300)?2:3;
      return base + N_from_S(S);
    }

    function min_hand_shafts(S,D){
      const N = N_from_S(S);
      const M = M_from_D(D);
      if(S<=300){
        if(D>20) return 2;
        else if(D>10) return 2;
        else return 1;
      } else if(S<=1000){
        if(D>20) return 3 + M;
        else if(D>10) return 3;
        else return 2;
      } else { // S>1000
        if(D>20) return 3 + N + M;
        else if(D>10) return 3 + N;
        else return 2 + N;
      }
    }

    // In-situ tests (both shear & plate)
    function in_situ_tests_count(D){
      if(D < 7) return 0;
      if(D <= 10) return 1;
      return 2;
    }

    // Downhole (outside table but required)
    function downhole_tests(F, boreholes){
      return (F>=11) ? Math.ceil(boreholes/3) : 0;
    }

    function format(n,unit=""){
      if(typeof n === "number" && !Number.isInteger(n)) n = Number(n.toFixed(2));
      return unit ? ${n} ${unit} : String(n);
    }

    function calcAll(S,D,B,F){
      S = Number(S); D = Number(D); B = Number(B); F = Number(F);
      if([S,D,B,F].some(x => !isFinite(x) || x<0)) throw new Error("ورودی‌ها را صحیح و غیرمنفی وارد کنید.");

      const kb = kB(S);
      const depth_from_start = kb*B + D;
      const depth_from_found = kb*B;

      const bh = min_boreholes(S);
      const hs = min_hand_shafts(S,D);

      const t = in_situ_tests_count(D); // applies to both shear & plate
      const dh = downhole_tests(F, bh);

      const N = N_from_S(S);
      const M = M_from_D(D);

      return {
        kb,
        depth_from_start,
        depth_from_found,
        min_boreholes: bh,
        min_hand_shafts: hs,
        shear_in_situ_tests: t,
        plate_load_tests: t,
        downhole_tests: dh,
        N_steps_value: N,
        M_steps_value: M
      };
    }

    function fillTable(rows){
      const tb = document.querySelector("#out tbody");
      tb.innerHTML = "";
      const add = (title, value, unit="")=>{
        const tr = document.createElement("tr");
        const td1 = document.createElement("td"); td1.textContent = title;
        const td2 = document.createElement("td"); td2.innerHTML = <kbd>${value}</kbd>;
        const td3 = document.createElement("td"); td3.textContent = unit;
        tr.append(td1,td2,td3); tb.appendChild(tr);
      };
      add("kB", rows.kb, "ضریب دسته‌بندی بر حسب S");
      add("عمق گمانه از تراز شروع حفاری", format(rows.depth_from_start,"m"));
      add("عمق گمانه از تراز زیرِپی", format(rows.depth_from_found,"m"));
      add("حداقل تعداد گمانه‌ها", rows.min_boreholes, "شامل N پلّه‌ای");
      add("حداقل تعداد چاهک گود", rows.min_hand_shafts, "شامل M پلّه‌ای (اگر D>20)");
      add("آزمایش برش برجا (تعداد)", rows.shear_in_situ_tests);
      add("آزمایش بارگذاری صفحه (تعداد)", rows.plate_load_tests);
      add("دان‌هول (در صورت F≥11)", rows.downhole_tests);
      add("N (افزایشی گمانه‌ها برای S>1000)", rows.N_steps_value, "هر پله 1000m² ⇒ +2");
      add("M (افزایشی چاهک‌ها برای D>20)", rows.M_steps_value, "هر 10m ⇒ +1");
    }

    document.getElementById("calc").addEventListener("click", () => {
      try{
        const S = document.getElementById("S").value;
        const D = document.getElementById("D").value;
        const B = document.getElementById("B").value;
        const F = document.getElementById("F").value;
        const rows = calcAll(S,D,B,F);
        fillTable(rows);
      }catch(e){
        alert(e.message || "خطا در ورودی‌ها");
      }
    });

    // PWA: register service worker
    if("serviceWorker" in navigator){
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("./sw.js").catch(()=>{});
      });
    }
  </script>
</body>
</html>
