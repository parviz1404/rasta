<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>GeoCalc — محاسبه‌گر گمانه/چاهک/آزمایش برجا (V7)</title>
  <style>
    body{font-family:ui-sans-serif,Segoe UI,Vazirmatn,Arial;margin:0;background:#f5f7fb;color:#0b1020}
    header{background:linear-gradient(90deg,#2563eb,#3b82f6);color:#fff;padding:14px 20px;box-shadow:0 4px 12px rgba(0,0,0,.08)}
    header h1{margin:0;font-size:18px}
    .wrap{max-width:980px;margin:20px auto;padding:0 16px}
    .card{background:#fff;border:1px solid #e6e8ef;border-radius:14px;padding:18px;box-shadow:0 10px 24px rgba(2,6,23,.06);margin-bottom:16px}
    h2{margin:0 0 10px;color:#2563eb;font-size:16px}
    label{display:block;font-weight:700;margin:8px 0 6px;color:#334155}
    input{width:100%;padding:10px 12px;border:1px solid #d6dae3;border-radius:10px;font-size:15px}
    input:focus{outline:2px solid #3b82f6;border-color:#3b82f6}
    .grid{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}
    .results{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));margin-top:8px}
    .res{background:#f8fafc;border:1px solid #e6e8ef;border-radius:12px;padding:12px;text-align:center}
    .res .k{font-size:12px;color:#6b7280}
    .res .v{font-size:20px;font-weight:900;color:#0b1020;margin-top:4px}
    table{width:100%;border-collapse:collapse;margin-top:10px}
    th,td{padding:10px;border-bottom:1px solid #e6e8ef;text-align:center}
    th{background:#f9fafb;color:#475569}
    .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-top:10px}
    .btn{padding:10px 14px;border-radius:10px;border:0;font-weight:800;cursor:pointer}
    .btn-primary{background:#2563eb;color:#fff} .btn-outline{background:#fff;color:#2563eb;border:2px solid #2563eb}
    .note{font-size:12px;color:#64748b}
    .err{color:#ef4444;font-size:13px;margin-top:6px;display:none}
  </style>
</head>
<body>
  <header><h1>GeoCalc — محاسبه‌گر ژئوتکنیک (V7)</h1></header>
  <div class="wrap">
    <div class="card">
      <h2>ورودی‌ها</h2>
      <div class="grid">
        <div><label>سطح اشغال S (m²)</label><input id="S" placeholder="مثلاً 2500"></div>
        <div><label>عمق گود Dmax (m)</label><input id="D" placeholder="مثلاً 27"></div>
        <div><label>عرض مؤثر B (m)</label><input id="B" placeholder="مثلاً 22"></div>
        <div><label>تعداد طبقات/سقف‌ها F</label><input id="F" placeholder="مثلاً 12"></div>
      </div>
      <div class="row">
        <button id="calc" class="btn btn-primary">محاسبه</button>
        <button id="reset" class="btn btn-outline">ریست</button>
        <span class="note">ارقام فارسی/ویرگول هم قابل قبول است (۱۲٬۳۴۵ → 12345).</span>
      </div>
      <div id="err" class="err">ورودی‌ها باید اعداد معتبر و غیرمنفی باشند.</div>
    </div>

    <div class="card">
      <h2>نتایج سریع</h2>
      <div class="results">
        <div class="res"><div class="k">عمق از شروع حفاری</div><div id="v_start" class="v">–</div></div>
        <div class="res"><div class="k">عمق از زیرِپی</div><div id="v_found" class="v">–</div></div>
        <div class="res"><div class="k">حداقل گمانه</div><div id="v_bh" class="v">–</div></div>
        <div class="res"><div class="k">حداقل چاهک</div><div id="v_hs" class="v">–</div></div>
        <div class="res"><div class="k">برش برجا</div><div id="v_shear" class="v">–</div></div>
        <div class="res"><div class="k">بارگذاری صفحه</div><div id="v_plate" class="v">–</div></div>
        <div class="res"><div class="k">دان‌هول</div><div id="v_dh" class="v">–</div></div>
      </div>

      <table>
        <thead><tr><th>شاخص</th><th>مقدار</th><th>توضیح</th></tr></thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>
  </div>

  <script>
    // --- تبدیل ارقام فارسی/عربی و ویرگول به عدد ---
    const faDigits=/[۰-۹]/g, arDigits=/[٠-٩]/g;
    const maps = {
      fa: {'۰':0,'۱':1,'۲':2,'۳':3,'۴':4,'۵':5,'۶':6,'۷':7,'۸':8,'۹':9},
      ar: {'٠':0,'١':1,'٢':2,'٣':3,'٤':4,'٥':5,'٦':6,'٧':7,'٨':8,'٩':9}
    };
    function toNumber(val){
      if(val==null) return NaN;
      let s = String(val).trim();
      s = s.replace(/\s+/g,'').replace(/,/g,'').replace('٬','');
      s = s.replace(faDigits, d => maps.fa[d]).replace(arDigits, d => maps.ar[d]);
      return Number(s);
    }

    // --- توابع منطق V7 ---
    function kB(S){ return (S<=300)?2:(S<=1000?1.5:1); }
    function N(S){ return (S>1000)? 2*Math.ceil((S-1000)/1000) : 0; } // هر پله ۱۰۰۰ ⇒ +۲
    function M(D){ return (D>20)? Math.ceil((D-20)/10) : 0; }         // هر ۱۰ بالای ۲۰ ⇒ +۱

    function boreholes(S){ return (S<=300?2:3) + N(S); }

    function handshafts(S,D){
      const n=N(S), m=M(D);
      if(S<=300){
        if(D>20) return 2;
        if(D>10) return 2;
        return 1;
      } else if(S<=1000){
        if(D>20) return 3+m;
        if(D>10) return 3;
        return 2;
      } else {
        if(D>20) return 3+n+m;
        if(D>10) return 3+n;
        return 2+n;
      }
    }
    function insitu(D){ if(D<7) return 0; if(D<=10) return 1; return 2; }
    function downhole(F,bh){ return (F>=11)? Math.ceil(bh/3) : 0; }

    // --- UI ---
    const $ = id=>document.getElementById(id);
    const inputs = ['S','D','B','F'].map($);

    function calc(){
      const S = toNumber($('S').value),
            D = toNumber($('D').value),
            B = toNumber($('B').value),
            F = toNumber($('F').value);
      if([S,D,B,F].some(x=>!isFinite(x)||x<0)) throw new Error('bad');
      const kb = kB(S);
      const start = (kb*B + D).toFixed(2);
      const found = (kb*B).toFixed(2);
      const bh = boreholes(S);
      const hs = handshafts(S,D);
      const t = insitu(D);
      const dh = downhole(F,bh);
      return {S,D,B,F,kb,start,found,bh,hs,shear:t,plate:t,dh,N:N(S),M:M(D)};
    }

    function render(){
      try{
        const r = calc();
        $('err').style.display='none';
        $('v_start').textContent = r.start+' m';
        $('v_found').textContent = r.found+' m';
        $('v_bh').textContent    = r.bh;
        $('v_hs').textContent    = r.hs;
        $('v_shear').textContent = r.shear;
        $('v_plate').textContent = r.plate;
        $('v_dh').textContent    = r.dh;

        const rows = [
          ['kB', r.kb, 'بر حسب S'],
          ['N',  r.N,  'هر ۱۰۰۰m² بالای ۱۰۰۰ ⇒ +۲ گمانه'],
          ['M',  r.M,  'هر ۱۰m بالای ۲۰ ⇒ +۱ چاهک'],
          ['عمق از شروع حفاری', r.start+' m', 'kB×B + D'],
          ['عمق از زیرِپی',     r.found+' m', 'kB×B'],
          ['حداقل گمانه',       r.bh, 'طبق جدول + N پلّه‌ای'],
          ['حداقل چاهک گود',    r.hs, 'طبق جدول + M پلّه‌ای (اگر D>20)'],
          ['برش برجا (تعداد)',  r.shear, 'D<7→0 ، 7–10→1 ، >10→2'],
          ['بارگذاری صفحه (تعداد)', r.plate, 'همسان برش برجا'],
          ['دان‌هول (اگر F≥11)', r.dh, 'ceil(گمانه/3)']
        ];
        const tb = $('tbody'); tb.innerHTML='';
        rows.forEach(rw=>{
          const tr=document.createElement('tr');
          rw.forEach(c=>{const td=document.createElement('td'); td.textContent=c; tr.appendChild(td);});
          tb.appendChild(tr);
        });
      }catch(e){
        $('err').style.display='block';
      }
    }

    $('calc').addEventListener('click', render);
    $('reset').addEventListener('click', ()=>{
      inputs.forEach(i=>i.value=''); render();
    });
    inputs.forEach(i=> i.addEventListener('input', render));

    // اولین رندر
    render();
  </script>
</body>
</html>
