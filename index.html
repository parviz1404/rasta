Parviz Abdi, [15/06/1404 03:50 ب.ظ]
<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>ماشین‌حساب تعداد و عمق گمانه | رستا</title>
<style>
  body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Tahoma,Arial,sans-serif;background:#f7fafc;color:#0a2a4a;margin:0}
  .wrap{max-width:900px;margin:24px auto;padding:16px}
  h1{font-size:20px;margin:0 0 8px}
  .card{background:#fff;border:1px solid #e6edf5;border-radius:14px;padding:14px 16px;margin:12px 0;box-shadow:0 8px 16px rgba(0,0,0,.04)}
  label{font-weight:600;font-size:14px}
  input{width:100%;padding:10px;border:1px solid #d7dde8;border-radius:10px;background:#fbfdff}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .btn{background:#00a7b7;color:#fff;border:none;border-radius:10px;padding:10px 14px;font-size:15px;cursor:pointer}
  .res{border:2px dashed #00a7b7;border-radius:12px;background:#f0fbfd;padding:12px;margin-top:10px}
  .muted{color:#445;opacity:.85;font-size:13px;line-height:1.9}
  small{opacity:.75}
  .err{color:#b00020}
</style>
</head>
<body>
<div class="wrap">
  <h1>ماشین‌حساب تعیین تعداد و عمق گمانه</h1>
  <small>بر اساس ساختار جدول ابلاغی سازمان نظام مهندسی استان تهران – <b>B = عرض زمین</b></small>

  <div class="card grid">
    <div><label>سطح اشغال S (m²)</label><input id="S" type="number" inputmode="decimal" placeholder="مثلاً 420"></div>
    <div><label>عمق گود D (m)</label><input id="D" type="number" inputmode="decimal" placeholder="مثلاً 6" step="0.1"></div>
    <div><label>عرض زمین B (m)</label><input id="B" type="number" inputmode="decimal" placeholder="مثلاً 14" step="0.1"></div>
    <div><label>پارامترها (N,M,Dtr)</label><input id="P" value="N=0,M=0,Dtr=0" placeholder="مثلاً N=1,M=0,Dtr=2"></div>
  </div>

  <button class="btn" onclick="calc()">محاسبه</button>
  <div id="out" class="res" style="display:none"></div>
  <div id="err" class="err" style="display:none"></div>

  <div class="card">
    <b>توضیحات مختصر</b>
    <p class="muted">
      عمق هر گمانه بر اساس فرمول سلول انتخابی محاسبه می‌شود (مانند <b>2B + Dtr</b>، <b>1.5B + Dtr</b>، <b>B + Dtr</b>).
      حداقل تعداد گمانه‌ها به تفکیک بازهٔ سطح اشغال و عمق گود از جدول خوانده می‌شود (۲، ۳، یا <b>۳+N</b> / <b>۳+M+N</b> برای قطعات بزرگ).
      برای گودهای عمیق (D&gt;10m) معمولاً <b>PLT/چاهک</b> اجباری است.
      <br>توجه: این ابزار راهنماست؛ تصمیم نهایی با مسئول فنی پروژه است.
    </p>
  </div>
</div>

<script>
/* دسته‌بندی‌ها */
const Sbins=[{k:"S0_300",min:0,max:300},{k:"S300_1000",min:300,max:1000},{k:"S1000_up",min:1000,max:1e9}];
function binS(S){for(const b of Sbins){if(S>b.min && S<=b.max) return b.k}return "S1000_up"}
function binD(D){if(D<=1)return"D_le_1";if(D<=10)return"D_1_10";if(D<=20)return"D_10_20";return"D_gt_20"}

/* جدول قواعد – در صورت نیاز متن‌ها را دقیقاً مطابق ابلاغ اصلاح کنید */
const table={
 "S0_300":{
   "D_le_1":  {depth:"2*B + Dtr", minBH:"2",      pits:"1",  plt:"در صورت نیاز"},
   "D_1_10":  {depth:"2*B + Dtr", minBH:"2",      pits:"2*B",plt:"در صورت نیاز"},
   "D_10_20": {depth:"2*B + Dtr", minBH:"2",      pits:"2*B",plt:"اجباری"},
   "D_gt_20": {depth:"2*B + Dtr", minBH:"3",      pits:"2*B",plt:"اجباری"}
 },
 "S300_1000":{
   "D_le_1":  {depth:"1.5*B + Dtr", minBH:"3",    pits:"2*B",plt:"در صورت نیاز"},
   "D_1_10":  {depth:"1.5*B + Dtr", minBH:"3",    pits:"2*B",plt:"در صورت نیاز"},
   "D_10_20": {depth:"1.5*B + Dtr", minBH:"3",    pits:"2*B",plt:"اجباری"},
   "D_gt_20": {depth:"1.5*B + Dtr", minBH:"3",    pits:"2*B",plt:"اجباری"}
 },
 "S1000_up":{
   "D_le_1":  {depth:"1*B + Dtr",   minBH:"3+N",  pits:"B",  plt:"اگر Dmax ≥ 7 باشد"},
   "D_1_10":  {depth:"1*B + Dtr",   minBH:"3+N",  pits:"B",  plt:"اگر Dmax ≥ 7 باشد"},
   "D_10_20": {depth:"1*B + Dtr",   minBH:"3+M+N",pits:"B",  plt:"اجباری"},
   "D_gt_20": {depth:"1*B + Dtr",   minBH:"3+M+N",pits:"B",  plt:"اجباری"}
 }
};

/* پارس ورودی پارامترها */
function parseP(s){
  const o={N:0,M:0,Dtr:0};
  (s||"").split(",").forEach(p=>{
    const kv=p.split("="); if(kv.length!==2) return;
    const k=kv[0].

Parviz Abdi, [15/06/1404 03:50 ب.ظ]
trim(); const v=parseFloat(kv[1].trim());
    if(Object.hasOwn(o,k) && !Number.isNaN(v)) o[k]=v;
  });
  return o;
}

/* ارزیابی امن عبارات ساده مثل 3+N یا 2*B + Dtr */
function evalExpr(expr, vars){
  const safe = expr.replace(/[^0-9+\-*/(). A-Za-z]/g,""); // حذف کاراکترهای ناامن
  const rep  = safe.replace(/\bB\b/g, vars.B).replace(/\bDtr\b/g, vars.Dtr)
                   .replace(/\bN\b/g, vars.N).replace(/\bM\b/g, vars.M);
  try{ return Number(Function(`"use strict";return (${rep})`)()); }
  catch{ return NaN; }
}

function val(id){ const v=parseFloat(document.getElementById(id).value); return Number.isFinite(v)?v:0; }

function calc(){
  const S = val('S');
  const D = val('D');
  const B = val('B');
  const P = parseP(document.getElementById('P').value);

  const err = document.getElementById('err');
  err.style.display='none'; err.textContent='';

  // حداقل ورودی: S و B
  if(S<=0 || B<=0){
    err.style.display='block';
    err.textContent='لطفاً حداقل «سطح اشغال S» و «عرض زمین B» را وارد کنید.';
    document.getElementById('out').style.display='none';
    return;
  }

  const cell = table[binS(S)][binD(D)];
  const minBH_num = evalExpr(cell.minBH, {B,Dtr:P.Dtr,N:P.N,M:P.M});
  const depth_num = evalExpr(cell.depth, {B,Dtr:P.Dtr,N:P.N,M:P.M});

  const minBH_disp = Number.isFinite(minBH_num) ? minBH_num : cell.minBH;
  const depth_disp = Number.isFinite(depth_num) ? depth_num.toFixed(2)+" m" : cell.depth;

  const out = document.getElementById('out');
  out.style.display='block';
  out.innerHTML = `
    <b>حداقل تعداد گمانه:</b> ${minBH_disp}<br>
    <b>عمق پیشنهادی هر گمانه:</b> ${depth_disp} <span class="muted">(B = عرض زمین)</span><br>
    <b>حداقل چاهک/پیت:</b> ${cell.pits} — <b>PLT:</b> ${cell.plt}
  `;
}
</script>
</body>
</html>
