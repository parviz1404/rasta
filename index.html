<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>GeoCalc V7 — محاسبه‌گر گمانه/چاهک/آزمایش برجا</title>

  <link rel="manifest" href="./manifest.webmanifest" />
  <meta name="theme-color" content="#2563eb" />
  <style>
    body {
      font-family: 'Segoe UI', 'Vazirmatn', Tahoma, sans-serif;
      margin: 0;
      background: #f3f4f6;
      color: #111827;
    }
    header {
      background: linear-gradient(90deg,#2563eb,#3b82f6);
      color: white;
      padding: 1rem 2rem;
      box-shadow: 0 4px 10px rgba(0,0,0,.1);
    }
    header h1 {
      margin: 0;
      font-size: 1.4rem;
      font-weight: 700;
    }
    .container {
      max-width: 1000px;
      margin: 2rem auto;
      padding: 0 1rem;
    }
    .card {
      background: white;
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      box-shadow: 0 6px 16px rgba(0,0,0,.08);
    }
    h2 { margin-top: 0; color:#2563eb }
    label { display:block; font-weight:600; margin:.5rem 0 .25rem }
    input {
      width:100%; padding:.6rem .8rem;
      border:1px solid #d1d5db; border-radius:8px;
      font-size:1rem;
    }
    input:focus {
      outline:2px solid #3b82f6; border-color:#3b82f6;
    }
    .grid {
      display:grid; gap:1rem;
      grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
    }
    table {
      width:100%; border-collapse:collapse; margin-top:1rem;
    }
    th,td {
      padding:.75rem; border-bottom:1px solid #e5e7eb; text-align:center;
    }
    th { background:#f9fafb; color:#374151 }
    .results {
      display:grid; gap:1rem;
      grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
      margin-top:1rem;
    }
    .res {
      background:#f9fafb; border:1px solid #e5e7eb; border-radius:10px;
      padding:1rem; text-align:center;
    }
    .res .val { font-size:1.4rem; font-weight:700; color:#111827 }
    .btn {
      padding:.7rem 1.2rem; border:0; border-radius:8px;
      font-weight:700; cursor:pointer; font-size:1rem;
    }
    .btn-primary {
      background:#2563eb; color:white;
    }
    .btn-secondary {
      background:white; color:#2563eb; border:2px solid #2563eb;
    }
    .toolbar { margin-top:1rem; display:flex; gap:.5rem; flex-wrap:wrap }
    footer { text-align:center; padding:1rem; color:#6b7280; font-size:.85rem }
  </style>
</head>
<body>
  <header><h1>GeoCalc V7 — محاسبه‌گر ژئوتکنیک</h1></header>

  <div class="container">
    <div class="card">
      <h2>ورودی‌ها</h2>
      <div class="grid">
        <div><label>S — سطح اشغال (m²)</label><input id="S" type="number" placeholder="مثلاً 2500"></div>
        <div><label>D — عمق گود Dmax (m)</label><input id="D" type="number" placeholder="مثلاً 27"></div>
        <div><label>B — عرض مؤثر سطح اشغال (m)</label><input id="B" type="number" placeholder="مثلاً 22"></div>
        <div><label>F — تعداد طبقات/سقف‌ها</label><input id="F" type="number" placeholder="مثلاً 12"></div>
      </div>
    </div>

    <div class="card">
      <h2>نتایج</h2>
      <div class="results">
        <div class="res"><div>عمق از شروع حفاری</div><div class="val" id="r_start">–</div></div>
        <div class="res"><div>عمق از زیرِپی</div><div class="val" id="r_found">–</div></div>
        <div class="res"><div>حداقل گمانه</div><div class="val" id="r_bh">–</div></div>
        <div class="res"><div>حداقل چاهک گود</div><div class="val" id="r_hs">–</div></div>
        <div class="res"><div>برش برجا</div><div class="val" id="r_shear">–</div></div>
        <div class="res"><div>بارگذاری صفحه</div><div class="val" id="r_plate">–</div></div>
        <div class="res"><div>دان‌هول</div><div class="val" id="r_dh">–</div></div>
      </div>

      <table>
        <thead><tr><th>شاخص</th><th>مقدار</th><th>توضیح</th></tr></thead>
        <tbody id="tableBody"></tbody>
      </table>

      <div class="toolbar">
        <button class="btn btn-secondary" id="copy">کپی JSON</button>
        <button class="btn btn-secondary" id="download">دانلود JSON</button>
      </div>
    </div>
  </div>

  <footer>GeoCalc V7 — N: هر ۱۰۰۰m² بالای ۱۰۰۰ ⇒ +۲ گمانه • M: هر ۱۰m بالای ۲۰ ⇒ +۱ چاهک</footer>

  <script>
    // --- محاسبات ---
    const S=document.getElementById('S'),D=document.getElementById('D'),B=document.getElementById('B'),F=document.getElementById('F');

    function kB(S){ return (S<=300)?2:(S<=1000?1.5:1); }
    function N(S){ return (S>1000)?2*Math.ceil((S-1000)/1000):0; }
    function M(D){ return (D>20)?Math.ceil((D-20)/10):0; }

    function boreholes(S){ return (S<=300?2:3)+N(S); }
    function handshafts(S,D){
      if(S<=300) return (D>10)?2:1;
      if(S<=1000){ if(D>20) return 3+M(D); if(D>10) return 3; return 2; }
      if(D>20) return 3+N(S)+M(D);
      if(D>10) return 3+N(S);
      return 2+N(S);
    }
    function insitu(D){ if(D<7) return 0; if(D<=10) return 1; return 2; }
    function downhole(F,bh){ return (F>=11)?Math.ceil(bh/3):0; }

    function calc(){
      const s=+S.value||0, d=+D.value||0, b=+B.value||0, f=+F.value||0;
      const kb=kB(s);
      const bh=boreholes(s);
      const hs=handshafts(s,d);
      const t=insitu(d);
      const dh=downhole(f,bh);
      return {
        start: (kb*b+d).toFixed(2), found:(kb*b).toFixed(2),
        bh, hs, shear:t, plate:t, dh, N:N(s), M:M(d), kb
      };
    }

    function render(){
      const r=calc();
      document.getElementById('r_start').textContent=r.start+" m";
      document.getElementById('r_found').textContent=r.found+" m";
      document.getElementById('r_bh').textContent=r.bh;
      document.getElementById('r_hs').textContent=r.hs;
      document.getElementById('r_shear').textContent=r.shear;
      document.getElementById('r_plate').textContent=r.plate;
      document.getElementById('r_dh').textContent=r.dh;

      const rows=[
        ["kB",r.kb,"ضریب دسته‌بندی"],
        ["N",r.N,"هر پله ۱۰۰۰m² ⇒ +۲ گمانه (S>1000)"],
        ["M",r.M,"هر ۱۰m بالای ۲۰ ⇒ +۱ چاهک"],
        ["عمق از شروع حفاری",r.start+" m","kB×B + D"],
        ["عمق از زیرِپی",r.found+" m","kB×B"],
        ["حداقل گمانه",r.bh,"طبق جدول + N"],
        ["حداقل چاهک",r.hs,"طبق جدول + M"],
        ["برش برجا",r.shear,"D<7=0, 7–10=1, >10=2"],
        ["بارگذاری صفحه",r.plate,"همان شرط"],
        ["دان‌هول",r.dh,"اگر F≥11 ⇒ ceil(bh/3)"]
      ];
      const tb=document.getElementById('tableBody'); tb.innerHTML="";
      rows.forEach(rw=>{
        const tr=document.createElement('tr');
        rw.forEach(c=>{const td=document.createElement('td'); td.textContent=c; tr.appendChild(td);});
        tb.appendChild(tr);
      });
      return r;
    }

    [S,D,B,F].forEach(el=> el.addEventListener('input',render));
    render();

    document.getElementById('copy').onclick=()=>{
      const r=render();
      navigator.clipboard.writeText(JSON.stringify(r,null,2));
      alert("کپی شد!");
    };
    document.getElementById('download').onclick=()=>{
      const r=render();
      const blob=new Blob([JSON.stringify(r,null,2)],{type:'application/json'});
      const a=document.createElement('a'); a.href=URL.createObjectURL(blob);
      a.download="geocalc-v7.json"; a.click();
    };

    if("serviceWorker" in navigator){ window.addEventListener("load",()=>navigator.serviceWorker.register("./sw.js")); }
  </script>
</body>
</html>
